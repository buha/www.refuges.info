************* A faire ************
includes/config_privee.php -> /config_privee.php
includes/conf_privee.php : $config -> $wri
Enlever /vue/_pied ... :
Supprimer controleurs/vue.php
Supprimer modeles/gestion.php
Add modeles/forum.php
Supprimer ext/.../api.php
*************************
Recherche en haut a droite de recherche par le nom, sur ma tablette, je clique dans le rectangle et il n'est pas possible d'y écrire quelque chose.
L'interprétation du "nouveau bbcode" plus riche semble moins bien passer coté site pour ce qui est des quotes
	https://dom.refuges.info/forum/viewtopic.php?f=4&t=6335&p=19629
Install
	Autorisations repertoires : trier celles pour install de celles pour prod
	Mettre les bonnes auth dans PhpBB3 reps & files -> SUR UNIX ?

*************************
J'ai rendu compatibles les environnements WRI et PhpBB
- Le gros avantage est que autoconnexion.php gère la connexion aux fiches en appelant la fonction d'autorisation du forum. Donc plus de différences !
Il n'y a que 2 niveaux dans WRI aujourd'hui : 0 = rien, >= 1 = tout et le code devient très simple :
https://github.com/RefugesInfo/www.refuges.info/blob/dev-dom/modeles/forum.php
- Il n'y a plus d'appels AJAX intra serveur entre les fiches et le forum.
Conditions nécéssaires:
- Supression de l'autoload WRI dont je n'ai pas trouvé à quoi il servait. Si je n'ai pas vu quelque chose, merci de me le signaler.
- Remplacement de la variable $config de WRI par $wri pour ne pas interférer avec la variable de PhpBB
Autres modifs:
- Les fonctions de modification du forum passent de /forum/ext/RefugesInfo/couplage/api.php dans un nouveau modèle /modeles/forum.php et sont appellées en sous-programme
https://github.com/RefugesInfo/www.refuges.info/blob/dev-dom/modeles/point.php#L562-L566
https://github.com/RefugesInfo/www.refuges.info/blob/dev-dom/modeles/point.php#L571-L575
https://github.com/RefugesInfo/www.refuges.info/blob/dev-dom/modeles/point.php#L611
https://github.com/RefugesInfo/www.refuges.info/blob/dev-dom/modeles/forum.php
- Le passage du bandeau et du pied des templates WRI aux templates phpBB devient simple et sans appel externe
https://github.com/RefugesInfo/www.refuges.info/blob/dev-dom/forum/ext/RefugesInfo/couplage/event/listener.php#L61-L76
- On descend d'un cran /includes/config_privee.php qui rejoint la racine parce que :
* ça me fait plaisir
* c'est plus facile à trouver pour le modifier
* l'autre fichier à renommer (le modèle .htaccess) est aussi à la racine
* c'est un peu la tradition dans le logiciel forum, ...
* ça préserve l'intégrité du répertoire /includes/... qui contient des fichiers sources
* étant appelé à la fois de WRI (/includes/config.php) et de PhpBB (/forum/config.php), il est logique qu'il soit à la racine
* ça permet de gérer la rupture d'interface ($config -> $wri) lors de l'upgrade puisque l'ancien pourra rester temporairement dans /includes
Enfin, si ça fâche trop, on peut le remettre dans /includes

Pour avis, relecture et tests avant basculement
https://github.com/RefugesInfo/www.refuges.info/tree/dev-dom
http://dom.refuges.info/

*************************
user 207 -> 216
topic 1202
posts 2760 2765 2810 14055
Dom92 2714
*************************
Fork dev-dom : Commits on Mar 28, 2017

//chmod 777 www.refuges.info/photos_points

chmod 777 www.refuges.info/forum/cache
chmod 777 www.refuges.info/forum/store
chmod 777 www.refuges.info/forum/files
chmod 777 www.refuges.info/forum/config.php
chmod 777 www.refuges.info/forum/images/avatars/upload
chmod 777 www.refuges.info/forum/images/avatars/gallery
chmod 777 www.refuges.info/forum/images/ranks
chmod 777 www.refuges.info/forum/images/smilies
chmod 777 www.refuges.info/forum/photos-points

*************************
MIGRATION
*************************
GITHUP
	Tortoise delete /forum /gestion
	commit
	Delete all sauf /leaflet
	copy zip dri sauf /leaflet & TODO
	Tortoise add *
	Retirer la partie init du listener
	commit
	
Save files WRI
Dezip & transfert tout PhpBB32 => /forum3
chmod 777 www.refuges.info/forum3/cache
chmod 777 www.refuges.info/forum3/store
chmod 777 www.refuges.info/forum3/files
chmod 777 www.refuges.info/forum3/config.php
chmod 777 www.refuges.info/forum3/images/avatars/upload
chmod 777 www.refuges.info/forum3/images/avatars/gallery
chmod 777 www.refuges.info/forum3/images/ranks
chmod 777 www.refuges.info/forum3/images/smilies
--- /forum3/includes/functions_convert.php
//		$convert->p_master->error(sprintf($user->lang['COULD_NOT_COPY'], $src_path, $phpbb_root_path . $trg_path), __LINE__, __FILE__, !$die_on_failure);

Bloquer WRI (.htaccess # mon IP)
Save files (delta taille #)
Save SQL
Renommer forum => forum2
Renommer forum3 => forum
Transférer forum2/photo_points => forum/photo_points

Install : lancer /forum
	français ==> CHANGE
	admin -> Idem refuges
	existe-pas@refuges.info
	-> Voir privé
	phpbb3_

lancer /forum/install
	CONVERTIR
	OPTIONS -> convertir
	phpbb_
	../forum2

Si debug
	Remplacer dans /forum/config.php
	@define('PHPBB_INSTALLED', true);
	// @define('PHPBB_DISPLAY_LOAD_TIME', true);
	//@define('PHPBB_ENVIRONMENT', 'production');
	@define('DEBUG_CONTAINER', true);
	error_reporting(E_ALL);
	ini_set('display_errors', 'on');

Renommer /forum/install -> install-
Supprimer les cokies du forum
Se connecter Dominique
Voir les paramètres phpbb de LISMOI.md
Purger les cookies & sessions
Lancer : /forum/ext/RefugesInfo/couplage/api.php?init

Voir avatars
Voir photos-points

rename /forum => /forum3
cd www.refuges.info
git checkout .
git pull
Refaire les chmod...
Move /forum3/images/avatars/upload/* => /forum/images/avatars/upload
Move /forum3/photos-points/* => /forum/photos-points

Enlever blocage htaccess

Affichage date = 18:00

GIT : Mettre à jour structure.sql avec les tables phpbb3_


INSTALL
-------
//git clone https://github.com/DC92/www.refuges.info.git
git clone -b dev-dom https://github.com/RefugesInfo/www.refuges.info.git
cp www.refuges.info/htaccess.modele.txt www.refuges.info/.htaccess
cp config_privee.php www.refuges.info/includes/config_privee.php
mkdir www.refuges.info/photos_points
chmod 777 www.refuges.info/photos_points
cp -r init/* www.refuges.info

manuellement
SQL delete points > max(phpbb_topics.topic_id_point
SQL delete Tables phpbb3_ + CASCADE
SQL delete Séquences phpbb3_ + CASCADE
SQL delete Domaines varchar_ci + CASCADE
